(function(){var e=function(g,f){if(arguments){e.prototype.init.apply(this,arguments)}};var b=YAHOO.util,d=YAHOO.lang,c=b.Dom,a=b.Event;b.Selectable=e;e.CSS_SELECTED="ui-selected";e.CSS_OVERLAY="ui-selectable-overlay";e.instances={};e.Overlay=function(){e.Overlay.prototype.init.call(this)};e.Overlay.prototype={cache:{},init:function(){this.element=document.createElement("div");this.element.className=e.CSS_OVERLAY;document.body.insertBefore(this.element,document.body.firstChild)},refreshCache:function(){var i=e.instances;for(var f in i){var h=i[f];var g=h.getChildren();c.batch(g,this._cacheRegion,this,true)}},_cacheRegion:function(f){var g=c.getRegion(f);var h=f.id||c.generateId(f);this.cache[h]=g},getContains:function(){var g=c.getRegion(this.element);var f=[];for(var h in this.cache){if(this.inRegion(this.cache[h],g)){f.push(c.get(h))}}return f},inRegion:function(g,f){if(f.contains(g)){return true}if(f.intersect(g)!=null){return true}return false},show:function(){this.refreshCache();c.removeClass(this.element,"ui-hidden")},hide:function(){c.addClass(this.element,"ui-hidden")},moveTo:function(f){c.setXY(this.element,f)},setHeight:function(f){c.setStyle(this.element,"height",f)},setWidth:function(f){c.setStyle(this.element,"width",f)}};e.register=function(f){e.instances[f.get("id")]=f;f.overlay=e.getOverlay()};e.getOverlay=function(){if(!e._overlay){e._overlay=new e.Overlay()}return e._overlay};YAHOO.extend(YAHOO.util.Selectable,YAHOO.util.Element,{selected:[],lastSelected:null,overlay:null,usingOverlay:false,mouseDown:false,initXy:[],init:function(g,f){e.superclass.init.call(this,g,f||{});e.register(this);this.initDomEvents()},initDomEvents:function(){this.on("click",this.handleClickEvent);this.on("mousedown",this.handleMouseDownEvent);a.addListener(document,"mouseup",this.handleMouseUpEvent,this,true);a.addListener(document,"mousemove",this.handleMouseMoveEvent,this,true)},initAttributes:function(f){e.superclass.initAttributes.call(this,f);this.setAttributeConfig("selectClass",{value:f.selectClass||e.CSS_SELECTED})},getChildren:function(){return c.getChildren(this.get("element"))},getElements:function(k,f){var i=this.getChildren();var j=function(m){for(var l=0;l<i.length;l++){if(i[l]==m){return l}}return -1};if(!d.isNumber(k)){var g=j(k);if(g==-1){return[]}else{k=g}}if(!d.isNumber(f)){var g=j(f);if(g==-1){return[]}else{f=g}}if(k>f){var h=k;k=f;f=h}return i.slice(k,f+1)},getTarget:function(f){var h=a.getTarget(f);if(!h||!h.parentNode){return null}var g=this.get("element");while(h&&h.parentNode&&h.parentNode!=g){h=h.parentNode}if(!h||h.parentNode!=g){return null}return h},select:function(f,g){if(this.isSelected(f)){return true}this.selected.push(f);c.addClass(f,this.get("selectClass"));this.lastSelected=f;return true},deselect:function(g,i){if(!this.isSelected(g)){return false}var f=this.selected,h;this.selected=[];this.lastSelected=g;while(h=f.pop()){if(h!=g){this.selected.push(h)}}c.removeClass(g,this.get("selectClass"));return true},selectRange:function(h,f){var g=this.getElements(h,f);c.batch(g,this.select,this,true)},isSelected:function(f){return c.hasClass(f,this.get("selectClass"))},selectAll:function(){this.selected=this.getChildren();c.addClass(this.selected,this.get("selectClass"))},deselectAll:function(){c.removeClass(this.selected,this.get("selectClass"));this.slected=[]},handleClickEvent:function(f){var h=this.getTarget(f);if(!h){return}var i=f.ctrlKey;var g=f.shiftKey;if(i==false){this.deselectAll()}if(g==true&&this.lastSelected){a.stopEvent(f);this.get("element").focus();this.selectRange(this.lastSelected,h);return}if(this.isSelected(h)){this.deselect(h)}else{this.select(h)}},handleMouseDownEvent:function(f){this.mouseDown=true;this.initXy=a.getXY(f)},handleMouseUpEvent:function(f){this.mouseDown=false;if(this.overlayShown){var g=this.overlay.getContains();if(!f.ctrlKey){this.deselectAll()}c.batch(g,this.select,this,true);this.overlay.hide();this.overlayShown=false}},handleMouseMoveEvent:function(g){if(this.mouseDown==false){return}if(this.overlayShown==false){this.overlay.show()}this.overlayShown=true;var j=a.getXY(g);var i=this.initXy;var h=Math.abs(j[0]-i[0]);var f=Math.abs(j[1]-i[1]);var k=[Math.min(j[0],i[0]),Math.min(j[1],i[1])];this.overlay.moveTo(k);this.overlay.setHeight(f+"px");this.overlay.setWidth(h+"px");this.overlay.element.focus()}})})();